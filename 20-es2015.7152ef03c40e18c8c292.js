(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{CbZG:function(i,t,e){"use strict";e.r(t),e.d(t,"VisitorPageModule",(function(){return F}));var o=e("SVse"),n=e("s7LF"),r=e("sZkV"),s=e("iInd"),c=e("pLZG"),a=e("lJxs");class l{constructor(){return new n.d({visitor_first_name:new n.b("",[n.m.required,n.m.minLength(1)]),visitor_last_name:new n.b("",[n.m.required,n.m.minLength(1)]),visitor_phone:new n.b("",[n.m.required,n.m.minLength(7),n.m.pattern("^[0-9]+$")]),visitor_email:new n.b("",n.m.compose([n.m.required,n.m.minLength(6)]))})}}var u=e("8Y7J"),b=e("9Ku7"),d=e("apZm"),m=e("ALmS"),v=e("nbgS");m.gql`
  subscription PlaceVisitorsCurrentCount($placeUUIDEquals: uuid! = "") {
    visit_aggregate(
      where: {
        _and: { place_uuid: { _eq: $placeUUIDEquals }, checked_out_at: { _is_null: true }, checked_in_at: { _is_null: false } }
      }
    ) {
      aggregate {
        count
      }
    }
  }
`;const h=m.gql`
  query PlaceDetails($placeUUIDEquals: uuid! = "875b4319-5b1c-44ef-9950-bc6004c4f77a") {
    place(where: { place_uuid: { _eq: $placeUUIDEquals } }, distinct_on: place_uuid) {
      business_name
      place_name
      place_description
      place_capacity
      place_address
      place_stay_estimate_minutes
    }
  }
`;let p=(()=>{class i{constructor(i){this.apollo=i}getPlaceDetails(i){return this.apollo.query({query:h,variables:{placeUUIDEquals:i}})}}return i.\u0275fac=function(t){return new(t||i)(u.Rb(v.b))},i.\u0275prov=u.Eb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const g=m.gql`
  mutation CreateVisitor(
    $visitorInsertObject: visitor_insert_input! = { visitor_first_name: "", visitor_last_name: "", visitor_phone: "", visitor_email: "" }
  ) {
    insert_visitor_one(
      object: $visitorInsertObject
      on_conflict: { constraint: visitor_visitor_first_name_visitor_last_name_visitor_phone__key, update_columns: updated_at }
    ) {
      visitor_uuid
    }
  }
`;let _=(()=>{class i{constructor(i){this.apollo=i}createVisitor({visitor_first_name:i,visitor_last_name:t,visitor_phone:e,visitor_email:o}){return this.apollo.mutate({mutation:g,variables:{visitorInsertObject:{visitor_first_name:i,visitor_last_name:t,visitor_phone:e,visitor_email:o}},errorPolicy:"all"})}}return i.\u0275fac=function(t){return new(t||i)(u.Rb(v.b))},i.\u0275prov=u.Eb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function k(i,t){if(1&i&&(u.Lb(0),u.nc(1),u.Yb(2,"async"),u.Yb(3,"date"),u.Kb()),2&i){const i=u.Xb();var e;u.yb(1),u.qc(" Thank you for checking in to ",null==(e=u.Zb(2,2,i.placeDetails))?null:e.place_name," ",u.ac(3,4,i.checkedInDateTime,"EEEE hh:mm:ss aaaa")," ")}}function f(i,t){if(1&i){const i=u.Ob();u.Nb(0,"ion-button",22),u.Vb("click",(function(t){return u.ic(i),u.Xb().clickCheckIn(t)})),u.Jb(1,"ion-icon",23),u.nc(2),u.Yb(3,"date"),u.Mb()}if(2&i){const i=u.Xb();u.dc("disabled",void 0===i.visitorUUIDForCheckin),u.yb(2),u.pc(" Check in ",u.ac(3,2,i.todayNow,"EEEE d MMMM yyyy")," ")}}function I(i,t){if(1&i&&(u.Lb(0),u.nc(1),u.Yb(2,"date"),u.Kb()),2&i){const i=u.Xb();u.yb(1),u.pc(" Thank you for checking out at ",u.ac(2,1,i.checkedInDateTime,"hh:mm:ss aaaa")," ")}}function y(i,t){if(1&i){const i=u.Ob();u.Nb(0,"ion-button",24),u.Vb("click",(function(t){return u.ic(i),u.Xb().clickCheckOut(t)})),u.nc(1),u.Yb(2,"date"),u.Jb(3,"ion-icon",25),u.Mb()}if(2&i){const i=u.Xb();u.dc("disabled",void 0===i.checkedInDateTime||void 0===i.visitorUUIDForCheckin)("color",i.checkedInDateTime?"success":"primary"),u.yb(1),u.pc(" Check out ",i.checkedInDateTime?u.ac(2,3,i.clockTime,"hh:mm:ss aaaa"):""," ")}}function C(i){console.log("VisitorPage:: getVisitorFieldsFromParamMap -> paramMap",i);const t=i.params;return console.log("VisitorPage:: extractHotlinkedVisitorParams -> unsafeExtractionObject",t),function(i){const{firstName:t,lastName:e,email:o,phone:n}=i;return{visitor_first_name:t,visitor_last_name:e,visitor_email:o,visitor_phone:n}}(t)}const D=[{path:"",component:(()=>{class i{constructor(i,t,e,o,n,r){this.activatedRoute=i,this.authenticationService=t,this.formBuilder=e,this.checkInOutService=o,this.placeService=n,this.visitorService=r,this.todayNow=new Date,this.clockTime=new Date,this.placeUUID=i.snapshot.paramMap.get("placeUUID"),console.log("VisitorPage -> constructor -> this.placeUUID",this.placeUUID),this.visitorForm=new l,this.visitorForm.valueChanges.subscribe(i=>{console.log("VisitorPage -> valueChanges",i,this.visitorForm)}),function({paramMap:i}){return console.log("VisitorPage:: activatedRouteParamMap",i),i.pipe(Object(a.a)(C))}(i).subscribe(i=>{console.log("VisitorPage -> constructor -> extractedVisitor",i),this.visitorForm.patchValue(i)});const s=n.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a");s.subscribe(({data:i,error:t,errors:e,loading:o,networkStatus:n,partial:r})=>{console.log("VisitorPage:: getPlaceDetails() -> error",t,e,o,n,r),console.log("VisitorPage:: getPlaceDetails() -> data",i)});const u=s.pipe(Object(c.a)(i=>{var t,e;return void 0!==(null===(e=null===(t=i.data)||void 0===t?void 0:t.place)||void 0===e?void 0:e[0])}),Object(a.a)(i=>i.data.place[0]));this.placeDetails=u,this.placeDeets=n.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a"),this.clockTimeIntervalID=this.getClockTimeUpdaterGranularSecond()}ngOnInit(){}getClockTimeUpdaterGranularSecond(){return setInterval(()=>{this.clockTime=new Date},1e3)}ngOnDestroy(){clearInterval(this.clockTimeIntervalID)}submitForm(i,{invalid:t,value:e}=this.visitorForm,o=this.visitorService){console.log("VisitorPage -> submitForm -> event",i),t||o.createVisitor(e).subscribe(i=>{var t,o;console.log("VisitorPage -> submitForm -> visitorResult",i),this.visitorUUIDForCheckin=null===(o=null===(t=i.data)||void 0===t?void 0:t.insert_visitor_one)||void 0===o?void 0:o.visitor_uuid,this.saveVisitorAutofill(e)})}saveVisitorAutofill(i){localStorage.setItem("visitor-autofill",JSON.stringify(i))}getVisitorAutofill(){const i=localStorage.getItem("visitor-autofill");if(null!=i)return JSON.parse(i)}autofillVisitorForm(i){this.visitorForm.patchValue(i)}clickAutofill(){const i=this.getVisitorAutofill();void 0!==i&&this.autofillVisitorForm(i)}clickCheckIn(i){if(console.log("clickCheckIn -> event",i),void 0===this.visitorUUIDForCheckin)return;const t=this.checkInOutService.createCheckInVisitor(this.placeUUID,this.visitorUUIDForCheckin).pipe(Object(a.a)(i=>{var t,e;const{data:o,errors:n,context:r,extensions:s}=i;return console.log("clickCheckIn -> data",o,n,r,s),this.checkedInTimestampStringIdentifier=null===(t=null==o?void 0:o.insert_visit_one)||void 0===t?void 0:t.checked_in_at,this.checkedInDateTime=new Date(null===(e=null==o?void 0:o.insert_visit_one)||void 0===e?void 0:e.checked_in_at),console.log("clickCheckIn -> this.checkedInTimestampStringIdentifier",this.checkedInTimestampStringIdentifier,this.checkedInDateTime),i}));this.checkedInObs=t}clickCheckOut(i){if(console.log("clickCheckOut -> event",i),console.log("placeUUID, visitorUUID, checkInTimestampString",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier),void 0===this.placeUUID||void 0===this.visitorUUIDForCheckin||void 0===this.checkedInTimestampStringIdentifier)return void console.log("Invalid details for checkout not stored.",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier);const t=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier).pipe(Object(a.a)(i=>{var t,e;return console.log("clickCheckOut -> interceptResult",i),this.checkedOutDateTime=new Date(null===(e=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.update_visit_by_pk)||void 0===e?void 0:e.checked_out_at),i}));this.checkedOutObs=t,this.checkedOutObs.subscribe(i=>{console.log("clickCheckOut -> a",i)})}}return i.\u0275fac=function(t){return new(t||i)(u.Ib(s.a),u.Ib(b.a),u.Ib(n.a),u.Ib(d.a),u.Ib(p),u.Ib(_))},i.\u0275cmp=u.Cb({type:i,selectors:[["app-visitor"]],decls:56,vars:22,consts:[["horizontal","start","vertical","bottom","slot","fixed","size","large"],["color","primary",3,"click"],["name","arrow-redo-circle-outline","size","large"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/les-logo-1-min-4kB.png","alt","Placeholder-image"],[2,"padding-left","0.5em","max-width","fit-content"],[2,"padding-left","0.55em"],["name","people"],["name","timer-outline"],["position","floating"],["formControlName","visitor_first_name","type","text","required","",3,"ngClass"],["formControlName","visitor_last_name","type","text","required","",3,"ngClass"],["formControlName","visitor_phone","type","tel","size","12","required","",3,"ngClass"],["formControlName","visitor_email","type","text","required","",3,"ngClass"],["icon-only","","size","block",1,"disable-button-greyed",3,"disabled","click"],["name","person-add-outline","slot","icon-only"],["type","submit"],[4,"ngIf","ngIfElse"],["pendingCheckIn",""],["pendingCheckOut",""],["color","light"],[3,"disabled","click"],["name","log-in-outline"],[3,"disabled","color","click"],["name","log-out-outline"]],template:function(i,t){if(1&i&&(u.Nb(0,"ion-header"),u.Nb(1,"ion-toolbar"),u.Nb(2,"ion-title"),u.nc(3,"Checki\u2705"),u.Mb(),u.Mb(),u.Mb(),u.Nb(4,"ion-fab",0),u.Nb(5,"ion-fab-button",1),u.Vb("click",(function(){return t.clickAutofill()})),u.Jb(6,"ion-icon",2),u.Mb(),u.Mb(),u.Nb(7,"ion-content"),u.Nb(8,"form",3,4),u.Vb("ngSubmit",(function(i){return t.submitForm(i)})),u.Nb(10,"ion-list"),u.Nb(11,"ion-list-header"),u.Nb(12,"ion-avatar"),u.Jb(13,"img",5),u.Mb(),u.Nb(14,"ion-label"),u.Nb(15,"h1",6),u.nc(16),u.Yb(17,"async"),u.Mb(),u.Nb(18,"h2",7),u.Jb(19,"ion-icon",8),u.nc(20),u.Yb(21,"async"),u.Jb(22,"ion-icon",9),u.nc(23),u.Yb(24,"async"),u.Mb(),u.Jb(25,"h3"),u.Mb(),u.Mb(),u.Nb(26,"ion-item"),u.Nb(27,"ion-label",10),u.nc(28," First name "),u.Mb(),u.Jb(29,"ion-input",11),u.Mb(),u.Nb(30,"ion-item"),u.Nb(31,"ion-label",10),u.nc(32," Last name "),u.Mb(),u.Jb(33,"ion-input",12),u.Mb(),u.Nb(34,"ion-item"),u.Nb(35,"ion-label",10),u.nc(36," Phone number "),u.Mb(),u.Jb(37,"ion-input",13),u.Mb(),u.Nb(38,"ion-item"),u.Nb(39,"ion-label",10),u.nc(40," Email address or residential address "),u.Mb(),u.Jb(41,"ion-input",14),u.Mb(),u.Mb(),u.Nb(42,"ion-button",15),u.Vb("click",(function(i){return t.submitForm(i)})),u.Jb(43,"ion-icon",16),u.Mb(),u.Jb(44,"button",17),u.Mb(),u.lc(45,k,4,7,"ng-container",18),u.lc(46,f,4,5,"ng-template",null,19,u.mc),u.Jb(48,"br"),u.lc(49,I,3,4,"ng-container",18),u.lc(50,y,4,6,"ng-template",null,20,u.mc),u.Jb(52,"br"),u.Nb(53,"ion-text",21),u.nc(54),u.Yb(55,"async"),u.Mb(),u.Mb()),2&i){const i=u.hc(47),r=u.hc(51);var e,o,n;u.yb(8),u.dc("formGroup",t.visitorForm),u.yb(8),u.pc(" ",null==(e=u.Zb(17,14,t.placeDetails))?null:e.place_name," "),u.yb(4),u.pc(" ",null==(o=u.Zb(21,16,t.placeDetails))?null:o.place_capacity,"\xa0 "),u.yb(3),u.pc(" ",null==(n=u.Zb(24,18,t.placeDetails))?null:n.place_stay_estimate_minutes," "),u.yb(6),u.dc("ngClass",null!=t.visitorForm.controls.visitor_first_name&&t.visitorForm.controls.visitor_first_name.pristine?"":null!=t.visitorForm.controls.visitor_first_name&&t.visitorForm.controls.visitor_first_name.invalid?"error-background":"success-background"),u.yb(4),u.dc("ngClass",null!=t.visitorForm.controls.visitor_last_name&&t.visitorForm.controls.visitor_last_name.pristine?"":null!=t.visitorForm.controls.visitor_last_name&&t.visitorForm.controls.visitor_last_name.invalid?"error-background":"success-background"),u.yb(4),u.dc("ngClass",null!=t.visitorForm.controls.visitor_phone&&t.visitorForm.controls.visitor_phone.pristine?"":null!=t.visitorForm.controls.visitor_phone&&t.visitorForm.controls.visitor_phone.invalid?"error-background":"success-background"),u.yb(4),u.dc("ngClass",null!=t.visitorForm.controls.visitor_email&&t.visitorForm.controls.visitor_email.pristine?"":null!=t.visitorForm.controls.visitor_email&&t.visitorForm.controls.visitor_email.invalid?"error-background":"success-background"),u.yb(1),u.dc("disabled",t.visitorForm.invalid),u.yb(3),u.dc("ngIf",t.checkedInDateTime)("ngIfElse",i),u.yb(4),u.dc("ngIf",t.checkedOutDateTime)("ngIfElse",r),u.yb(5),u.pc(" | ",u.Zb(55,20,t.checkedInObs)?" Checked in ":""," | {{checkedOutObs | async} ? ' Checked out ' : ' '} ")}},directives:[r.j,r.x,r.w,r.h,r.i,r.k,r.g,n.n,n.j,n.e,r.r,r.s,r.b,r.q,r.m,r.l,r.C,n.i,n.c,n.l,o.k,r.e,o.m,r.v],pipes:[o.b,o.e],styles:['@charset "UTF-8";.submit-enter[_ngcontent-%COMP%]{position:absolute;visibility:hidden;left:-1000px}ion-icon[_ngcontent-%COMP%]{vertical-align:middle}ion-input[_ngcontent-%COMP%]   .error-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-danger-rgb),0.8)}.error-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-danger-rgb),0.6)}.success-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-success-rgb),0.6)}.success-background[_ngcontent-%COMP%]:after{content:"\u2705"}.disable-button-greyed[_ngcontent-%COMP%]:disabled, disable-button-greyed[disabled][_ngcontent-%COMP%]{color:#fff!important;opacity:.8!important;background:#b3b3b3!important}']}),i})()}];let U=(()=>{class i{}return i.\u0275mod=u.Gb({type:i}),i.\u0275inj=u.Fb({factory:function(t){return new(t||i)},imports:[[s.i.forChild(D)],s.i]}),i})(),F=(()=>{class i{}return i.\u0275mod=u.Gb({type:i}),i.\u0275inj=u.Fb({factory:function(t){return new(t||i)},imports:[[o.c,n.f,n.k,r.y,U]]}),i})()}}]);