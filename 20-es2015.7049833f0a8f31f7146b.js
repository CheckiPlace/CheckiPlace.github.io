(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{CbZG:function(e,i,t){"use strict";t.r(i),t.d(i,"VisitorPageModule",(function(){return M}));var n=t("SVse"),o=t("s7LF"),c=t("sZkV"),a=t("iInd"),s=t("pLZG"),r=t("lJxs");class l{constructor(){return new o.d({visitor_first_name:new o.b("",[o.m.required,o.m.minLength(1)]),visitor_last_name:new o.b("",[o.m.required,o.m.minLength(1)]),visitor_phone:new o.b("",[o.m.required,o.m.minLength(10)]),visitor_email:new o.b("",o.m.compose([o.m.required,o.m.pattern("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$")]))})}}var b=t("8Y7J"),u=t("9Ku7"),d=t("apZm"),m=t("ALmS"),h=t("nbgS");m.gql`
  subscription PlaceVisitorsCurrentCount($placeUUIDEquals: uuid! = "") {
    visit_aggregate(
      where: {
        _and: { place_uuid: { _eq: $placeUUIDEquals }, checked_out_at: { _is_null: true }, checked_in_at: { _is_null: false } }
      }
    ) {
      aggregate {
        count
      }
    }
  }
`;const p=m.gql`
  query PlaceDetails($placeUUIDEquals: uuid! = "875b4319-5b1c-44ef-9950-bc6004c4f77a") {
    place(where: { place_uuid: { _eq: $placeUUIDEquals } }, distinct_on: place_uuid) {
      business_name
      place_name
      place_description
      place_capacity
      place_address
      place_stay_estimate_minutes
    }
  }
`;let v=(()=>{class e{constructor(e){this.apollo=e}getPlaceDetails(e){return this.apollo.query({query:p,variables:{placeUUIDEquals:e}})}}return e.\u0275fac=function(i){return new(i||e)(b.Rb(h.b))},e.\u0275prov=b.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _=m.gql`
  mutation CreateVisitor(
    $visitorInsertObject: visitor_insert_input! = { visitor_first_name: "", visitor_last_name: "", visitor_phone: "", visitor_email: "" }
  ) {
    insert_visitor_one(
      object: $visitorInsertObject
      on_conflict: { constraint: visitor_visitor_first_name_visitor_last_name_visitor_phone__key, update_columns: updated_at }
    ) {
      visitor_uuid
    }
  }
`;let g=(()=>{class e{constructor(e){this.apollo=e}createVisitor({visitor_first_name:e,visitor_last_name:i,visitor_phone:t,visitor_email:n}){return this.apollo.mutate({mutation:_,variables:{visitorInsertObject:{visitor_first_name:e,visitor_last_name:i,visitor_phone:t,visitor_email:n}},errorPolicy:"all"})}}return e.\u0275fac=function(i){return new(i||e)(b.Rb(h.b))},e.\u0275prov=b.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function k(e,i){if(1&e&&(b.Lb(0),b.nc(1),b.Yb(2,"async"),b.Yb(3,"date"),b.Kb()),2&e){const e=b.Xb();var t;b.yb(1),b.qc(" Thank you for checking in to ",null==(t=b.Zb(2,2,e.placeDetails))?null:t.place_name," ",b.ac(3,4,e.checkedInDateTime,"EEEE hh:mm:ss aaaa")," ")}}function I(e,i){if(1&e){const e=b.Ob();b.Nb(0,"ion-button",20),b.Vb("click",(function(i){return b.ic(e),b.Xb().clickCheckIn(i)})),b.Jb(1,"ion-icon",21),b.nc(2),b.Yb(3,"date"),b.Mb()}if(2&e){const e=b.Xb();b.dc("disabled",void 0===e.visitorUUIDForCheckin),b.yb(2),b.pc(" Check in ",b.ac(3,2,e.todayNow,"EEEE d MMMM yyyy")," ")}}function f(e,i){if(1&e&&(b.Lb(0),b.nc(1),b.Yb(2,"date"),b.Kb()),2&e){const e=b.Xb();b.yb(1),b.pc(" Thank you for checking out at ",b.ac(2,1,e.checkedInDateTime,"hh:mm:ss aaaa")," ")}}function y(e,i){if(1&e){const e=b.Ob();b.Nb(0,"ion-button",22),b.Vb("click",(function(i){return b.ic(e),b.Xb().clickCheckOut(i)})),b.nc(1),b.Yb(2,"date"),b.Jb(3,"ion-icon",23),b.Mb()}if(2&e){const e=b.Xb();b.dc("disabled",void 0===e.checkedInDateTime||void 0===e.visitorUUIDForCheckin)("color",e.checkedInDateTime?"success":"primary"),b.yb(1),b.pc(" Check out ",e.checkedInDateTime?b.ac(2,3,e.clockTime,"hh:mm:ss aaaa"):""," ")}}function D(e){console.log("VisitorPage:: getVisitorFieldsFromParamMap -> paramMap",e);const i=e.params;return console.log("VisitorPage:: extractHotlinkedVisitorParams -> unsafeExtractionObject",i),function(e){const{firstName:i,lastName:t,email:n,phone:o}=e;return{visitor_first_name:i,visitor_last_name:t,visitor_email:n,visitor_phone:o}}(i)}const U=[{path:"",component:(()=>{class e{constructor(e,i,t,n,o,c){this.activatedRoute=e,this.authenticationService=i,this.formBuilder=t,this.checkInOutService=n,this.placeService=o,this.visitorService=c,this.todayNow=new Date,this.clockTime=new Date,this.placeUUID=e.snapshot.paramMap.get("placeUUID"),console.log("VisitorPage -> constructor -> this.placeUUID",this.placeUUID),this.visitorForm=new l,this.visitorForm.valueChanges.subscribe(e=>{console.log("VisitorPage -> valueChanges",e,this.visitorForm)}),function({paramMap:e}){return console.log("VisitorPage:: activatedRouteParamMap",e),e.pipe(Object(r.a)(D))}(e).subscribe(e=>{console.log("VisitorPage -> constructor -> extractedVisitor",e),this.visitorForm.patchValue(e)});const a=o.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a");a.subscribe(({data:e,error:i,errors:t,loading:n,networkStatus:o,partial:c})=>{console.log("VisitorPage:: getPlaceDetails() -> error",i,t,n,o,c),console.log("VisitorPage:: getPlaceDetails() -> data",e)});const b=a.pipe(Object(s.a)(e=>{var i,t;return void 0!==(null===(t=null===(i=e.data)||void 0===i?void 0:i.place)||void 0===t?void 0:t[0])}),Object(r.a)(e=>e.data.place[0]));this.placeDetails=b,this.placeDeets=o.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a"),this.clockTimeIntervalID=this.getClockTimeUpdaterGranularSecond()}ngOnInit(){}getClockTimeUpdaterGranularSecond(){return setInterval(()=>{this.clockTime=new Date},1e3)}ngOnDestroy(){clearInterval(this.clockTimeIntervalID)}submitForm(e,{invalid:i,value:t}=this.visitorForm,n=this.visitorService){console.log("VisitorPage -> submitForm -> event",e),i||n.createVisitor(t).subscribe(e=>{var i,t;console.log("VisitorPage -> submitForm -> visitorResult",e),this.visitorUUIDForCheckin=null===(t=null===(i=e.data)||void 0===i?void 0:i.insert_visitor_one)||void 0===t?void 0:t.visitor_uuid})}clickCheckIn(e){if(console.log("clickCheckIn -> event",e),void 0===this.visitorUUIDForCheckin)return;const i=this.checkInOutService.createCheckInVisitor(this.placeUUID,this.visitorUUIDForCheckin).pipe(Object(r.a)(e=>{var i,t;const{data:n,errors:o,context:c,extensions:a}=e;return console.log("clickCheckIn -> data",n,o,c,a),this.checkedInTimestampStringIdentifier=null===(i=null==n?void 0:n.insert_visit_one)||void 0===i?void 0:i.checked_in_at,this.checkedInDateTime=new Date(null===(t=null==n?void 0:n.insert_visit_one)||void 0===t?void 0:t.checked_in_at),console.log("clickCheckIn -> this.checkedInTimestampStringIdentifier",this.checkedInTimestampStringIdentifier,this.checkedInDateTime),e}));this.checkedInObs=i}clickCheckOut(e){if(console.log("clickCheckOut -> event",e),console.log("placeUUID, visitorUUID, checkInTimestampString",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier),void 0===this.placeUUID||void 0===this.visitorUUIDForCheckin||void 0===this.checkedInTimestampStringIdentifier)return void console.log("Invalid details for checkout not stored.",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier);const i=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier).pipe(Object(r.a)(e=>{var i,t;return console.log("clickCheckOut -> interceptResult",e),this.checkedOutDateTime=new Date(null===(t=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.update_visit_by_pk)||void 0===t?void 0:t.checked_out_at),e}));this.checkedOutObs=i}}return e.\u0275fac=function(i){return new(i||e)(b.Ib(a.a),b.Ib(u.a),b.Ib(o.a),b.Ib(d.a),b.Ib(v),b.Ib(g))},e.\u0275cmp=b.Cb({type:e,selectors:[["app-visitor"]],decls:71,vars:40,consts:[["src","/assets/images/les-logo-256px-min.png","alt","Placeholder-image",2,"width","12em"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/les-logo-1-min-4kB.png","alt","Placeholder-image"],[2,"padding-left","0.5em","max-width","fit-content"],[2,"padding-left","0.55em"],["name","people"],["name","timer-outline"],["position","floating"],["formControlName","visitor_first_name","type","text","required",""],["formControlName","visitor_last_name","type","text","required",""],["formControlName","visitor_phone","type","tel","size","12","required",""],["formControlName","visitor_email","type","text","required",""],["icon-only","","size","block",3,"disabled","click"],["name","person-add-outline","slot","icon-only"],["type","submit"],[4,"ngIf","ngIfElse"],["pendingCheckIn",""],["pendingCheckOut",""],["color","light"],[3,"disabled","click"],["name","log-in-outline"],[3,"disabled","color","click"],["name","log-out-outline"]],template:function(e,i){if(1&e&&(b.Nb(0,"ion-header"),b.Nb(1,"ion-toolbar"),b.Nb(2,"ion-title"),b.nc(3,"Checki\u2705"),b.Mb(),b.Mb(),b.Mb(),b.Nb(4,"ion-content"),b.Nb(5,"ion-card"),b.Nb(6,"ion-card-header"),b.nc(7,"Place"),b.Mb(),b.Nb(8,"ion-card-title"),b.nc(9," Logan Endoscopy Services "),b.Mb(),b.Jb(10,"img",0),b.Nb(11,"ion-card-subtitle"),b.nc(12),b.Yb(13,"async"),b.Mb(),b.Mb(),b.nc(14),b.Nb(15,"form",1,2),b.Vb("ngSubmit",(function(e){return i.submitForm(e)})),b.Nb(17,"ion-list"),b.Nb(18,"ion-list-header"),b.Nb(19,"ion-avatar"),b.Jb(20,"img",3),b.Mb(),b.Nb(21,"ion-label"),b.Nb(22,"h1",4),b.nc(23),b.Yb(24,"async"),b.Mb(),b.Nb(25,"h2",5),b.Jb(26,"ion-icon",6),b.nc(27),b.Yb(28,"async"),b.Jb(29,"ion-icon",7),b.nc(30),b.Yb(31,"async"),b.Mb(),b.Jb(32,"h3"),b.Mb(),b.Mb(),b.Nb(33,"ion-item"),b.Nb(34,"ion-label",8),b.nc(35," First name "),b.Mb(),b.Jb(36,"ion-input",9),b.Mb(),b.Nb(37,"ion-item"),b.Nb(38,"ion-label",8),b.nc(39," Last name "),b.Mb(),b.Jb(40,"ion-input",10),b.Mb(),b.Nb(41,"ion-item"),b.Nb(42,"ion-label",8),b.nc(43," Phone number "),b.Mb(),b.Jb(44,"ion-input",11),b.Mb(),b.Nb(45,"ion-item"),b.Nb(46,"ion-label",8),b.nc(47," Email address "),b.Mb(),b.Jb(48,"ion-input",12),b.Mb(),b.Mb(),b.Nb(49,"ion-button",13),b.Vb("click",(function(e){return i.submitForm(e)})),b.Jb(50,"ion-icon",14),b.Mb(),b.Jb(51,"button",15),b.Mb(),b.lc(52,k,4,7,"ng-container",16),b.lc(53,I,4,5,"ng-template",null,17,b.mc),b.Jb(55,"br"),b.lc(56,f,3,4,"ng-container",16),b.lc(57,y,4,6,"ng-template",null,18,b.mc),b.Jb(59,"br"),b.nc(60),b.Nb(61,"ion-text",19),b.nc(62),b.Yb(63,"json"),b.Yb(64,"async"),b.Yb(65,"json"),b.Yb(66,"async"),b.Yb(67,"json"),b.Yb(68,"async"),b.Yb(69,"json"),b.Yb(70,"async"),b.Mb(),b.Mb()),2&e){const e=b.hc(54),a=b.hc(58);var t,n,o,c;b.yb(12),b.pc(" ",null==(t=b.Zb(13,16,i.placeDetails))?null:t.place_description," "),b.yb(2),b.pc(" ",i.visitorUUIDForCheckin," "),b.yb(1),b.dc("formGroup",i.visitorForm),b.yb(8),b.pc(" ",null==(n=b.Zb(24,18,i.placeDetails))?null:n.place_name," "),b.yb(4),b.pc(" ",null==(o=b.Zb(28,20,i.placeDetails))?null:o.place_capacity,"\xa0 "),b.yb(3),b.pc(" ",null==(c=b.Zb(31,22,i.placeDetails))?null:c.place_stay_estimate_minutes," "),b.yb(19),b.dc("disabled",i.visitorForm.invalid),b.yb(3),b.dc("ngIf",i.checkedInDateTime)("ngIfElse",e),b.yb(4),b.dc("ngIf",i.checkedOutDateTime)("ngIfElse",a),b.yb(4),b.pc(" ",i.visitorUUIDForCheckin," "),b.yb(2),b.sc(" | ",b.Zb(63,24,b.Zb(64,26,i.checkedInObs))," ",b.Zb(65,28,b.Zb(66,30,i.checkedOutObs))," | ",b.Zb(67,32,b.Zb(68,34,i.placeDetails))," Test 2 ",b.Zb(69,36,b.Zb(70,38,i.placeDeets))," ")}},directives:[c.l,c.z,c.y,c.k,c.g,c.h,c.j,c.i,o.n,o.j,o.e,c.t,c.u,c.b,c.s,c.m,c.o,c.n,c.E,o.i,o.c,o.l,c.e,n.l,c.x],pipes:[n.b,n.g,n.e],styles:[".submit-enter[_ngcontent-%COMP%]{position:absolute;visibility:hidden;left:-1000px}ion-icon[_ngcontent-%COMP%]{vertical-align:middle}"]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(i){return new(i||e)},imports:[[a.i.forChild(U)],a.i]}),e})(),M=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(i){return new(i||e)},imports:[[n.c,o.f,o.k,c.A,C]]}),e})()}}]);