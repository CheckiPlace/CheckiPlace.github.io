!function(){function i(){var e=r(['\n  mutation CreateVisitor(\n    $visitorInsertObject: visitor_insert_input! = { visitor_first_name: "", visitor_last_name: "", visitor_phone: "", visitor_email: "" }\n  ) {\n    insert_visitor_one(\n      object: $visitorInsertObject\n      on_conflict: { constraint: visitor_visitor_first_name_visitor_last_name_visitor_phone__key, update_columns: updated_at }\n    ) {\n      visitor_uuid\n    }\n  }\n']);return i=function(){return e},e}function e(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function t(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}function n(){var i=r(['\n  query PlaceDetails($placeUUIDEquals: uuid! = "875b4319-5b1c-44ef-9950-bc6004c4f77a") {\n    place(where: { place_uuid: { _eq: $placeUUIDEquals } }, distinct_on: place_uuid) {\n      business_name\n      place_name\n      place_description\n      place_capacity\n      place_address\n      place_stay_estimate_minutes\n    }\n  }\n']);return n=function(){return i},i}function o(){var i=r(['\n  subscription PlaceVisitorsCurrentCount($placeUUIDEquals: uuid! = "") {\n    visit_aggregate(\n      where: {\n        _and: { place_uuid: { _eq: $placeUUIDEquals }, checked_out_at: { _is_null: true }, checked_in_at: { _is_null: false } }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n  }\n']);return o=function(){return i},i}function r(i,e){return e||(e=i.slice(0)),Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(e)}}))}function c(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{CbZG:function(e,r,a){"use strict";a.r(r),a.d(r,"VisitorPageModule",(function(){return E}));var s=a("SVse"),l=a("s7LF"),u=a("sZkV"),b=a("iInd"),v=a("pLZG"),d=a("lJxs"),m=function i(){return c(this,i),new l.d({visitor_first_name:new l.b("",[l.m.required,l.m.minLength(1)]),visitor_last_name:new l.b("",[l.m.required,l.m.minLength(1)]),visitor_phone:new l.b("",[l.m.required,l.m.minLength(7),l.m.pattern("^[0-9]+$")]),visitor_email:new l.b("",l.m.compose([l.m.required,l.m.minLength(6)]))})},h=a("8Y7J"),p=a("9Ku7"),f=a("apZm"),g=a("ALmS"),k=a("nbgS");g.gql(o());var _,I,y=g.gql(n()),C=((_=function(){function i(e){c(this,i),this.apollo=e}return t(i,[{key:"getPlaceDetails",value:function(i){return this.apollo.query({query:y,variables:{placeUUIDEquals:i}})}}]),i}()).\u0275fac=function(i){return new(i||_)(h.Rb(k.b))},_.\u0275prov=h.Eb({token:_,factory:_.\u0275fac,providedIn:"root"}),_),D=g.gql(i()),U=((I=function(){function i(e){c(this,i),this.apollo=e}return t(i,[{key:"createVisitor",value:function(i){var e=i.visitor_first_name,t=i.visitor_last_name,n=i.visitor_phone,o=i.visitor_email;return this.apollo.mutate({mutation:D,variables:{visitorInsertObject:{visitor_first_name:e,visitor_last_name:t,visitor_phone:n,visitor_email:o}},errorPolicy:"all"})}}]),i}()).\u0275fac=function(i){return new(i||I)(h.Rb(k.b))},I.\u0275prov=h.Eb({token:I,factory:I.\u0275fac,providedIn:"root"}),I);function F(i,e){if(1&i&&(h.Lb(0),h.nc(1),h.Yb(2,"async"),h.Yb(3,"date"),h.Kb()),2&i){var t,n=h.Xb();h.yb(1),h.qc(" Thank you for checking in to ",null==(t=h.Zb(2,2,n.placeDetails))?null:t.place_name," ",h.ac(3,4,n.checkedInDateTime,"EEEE hh:mm:ss aaaa")," ")}}function O(i,e){if(1&i){var t=h.Ob();h.Nb(0,"ion-button",22),h.Vb("click",(function(i){return h.ic(t),h.Xb().clickCheckIn(i)})),h.Jb(1,"ion-icon",23),h.nc(2),h.Yb(3,"date"),h.Mb()}if(2&i){var n=h.Xb();h.dc("disabled",void 0===n.visitorUUIDForCheckin),h.yb(2),h.pc(" Check in ",h.ac(3,2,n.todayNow,"EEEE d MMMM yyyy")," ")}}function M(i,e){if(1&i&&(h.Lb(0),h.nc(1),h.Yb(2,"date"),h.Kb()),2&i){var t=h.Xb();h.yb(1),h.pc(" Thank you for checking out at ",h.ac(2,1,t.checkedInDateTime,"hh:mm:ss aaaa")," ")}}function N(i,e){if(1&i){var t=h.Ob();h.Nb(0,"ion-button",24),h.Vb("click",(function(i){return h.ic(t),h.Xb().clickCheckOut(i)})),h.nc(1),h.Yb(2,"date"),h.Jb(3,"ion-icon",25),h.Mb()}if(2&i){var n=h.Xb();h.dc("disabled",void 0===n.checkedInDateTime||void 0===n.visitorUUIDForCheckin)("color",n.checkedInDateTime?"success":"primary"),h.yb(1),h.pc(" Check out ",n.checkedInDateTime?h.ac(2,3,n.clockTime,"hh:mm:ss aaaa"):""," ")}}function P(i){console.log("VisitorPage:: getVisitorFieldsFromParamMap -> paramMap",i);var e=i.params;return console.log("VisitorPage:: extractHotlinkedVisitorParams -> unsafeExtractionObject",e),function(i){return{visitor_first_name:i.firstName,visitor_last_name:i.lastName,visitor_email:i.email,visitor_phone:i.phone}}(e)}var V,w,T,S=[{path:"",component:(V=function(){function i(e,t,n,o,r,a){var s,l,u=this;c(this,i),this.activatedRoute=e,this.authenticationService=t,this.formBuilder=n,this.checkInOutService=o,this.placeService=r,this.visitorService=a,this.todayNow=new Date,this.clockTime=new Date,this.placeUUID=e.snapshot.paramMap.get("placeUUID"),console.log("VisitorPage -> constructor -> this.placeUUID",this.placeUUID),this.visitorForm=new m,this.visitorForm.valueChanges.subscribe((function(i){console.log("VisitorPage -> valueChanges",i,u.visitorForm)})),(s=e,l=s.paramMap,console.log("VisitorPage:: activatedRouteParamMap",l),l.pipe(Object(d.a)(P))).subscribe((function(i){console.log("VisitorPage -> constructor -> extractedVisitor",i),u.visitorForm.patchValue(i)}));var b=r.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a");b.subscribe((function(i){var e=i.data,t=i.error,n=i.errors,o=i.loading,r=i.networkStatus,c=i.partial;console.log("VisitorPage:: getPlaceDetails() -> error",t,n,o,r,c),console.log("VisitorPage:: getPlaceDetails() -> data",e)}));var h=b.pipe(Object(v.a)((function(i){var e,t;return void 0!==(null===(t=null===(e=i.data)||void 0===e?void 0:e.place)||void 0===t?void 0:t[0])})),Object(d.a)((function(i){return i.data.place[0]})));this.placeDetails=h,this.placeDeets=r.getPlaceDetails("875b4319-5b1c-44ef-9950-bc6004c4f77a"),this.clockTimeIntervalID=this.getClockTimeUpdaterGranularSecond()}return t(i,[{key:"ngOnInit",value:function(){}},{key:"getClockTimeUpdaterGranularSecond",value:function(){var i=this;return setInterval((function(){i.clockTime=new Date}),1e3)}},{key:"ngOnDestroy",value:function(){clearInterval(this.clockTimeIntervalID)}},{key:"submitForm",value:function(i){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.visitorForm,n=t.invalid,o=t.value,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.visitorService;console.log("VisitorPage -> submitForm -> event",i),n||r.createVisitor(o).subscribe((function(i){var t,n;console.log("VisitorPage -> submitForm -> visitorResult",i),e.visitorUUIDForCheckin=null===(n=null===(t=i.data)||void 0===t?void 0:t.insert_visitor_one)||void 0===n?void 0:n.visitor_uuid,e.saveVisitorAutofill(o)}))}},{key:"saveVisitorAutofill",value:function(i){localStorage.setItem("visitor-autofill",JSON.stringify(i))}},{key:"getVisitorAutofill",value:function(){var i=localStorage.getItem("visitor-autofill");if(null!=i)return JSON.parse(i)}},{key:"autofillVisitorForm",value:function(i){this.visitorForm.patchValue(i)}},{key:"clickAutofill",value:function(){var i=this.getVisitorAutofill();void 0!==i&&this.autofillVisitorForm(i)}},{key:"clickCheckIn",value:function(i){var e=this;if(console.log("clickCheckIn -> event",i),void 0!==this.visitorUUIDForCheckin){var t=this.checkInOutService.createCheckInVisitor(this.placeUUID,this.visitorUUIDForCheckin).pipe(Object(d.a)((function(i){var t,n,o=i.data,r=i.errors,c=i.context,a=i.extensions;return console.log("clickCheckIn -> data",o,r,c,a),e.checkedInTimestampStringIdentifier=null===(t=null==o?void 0:o.insert_visit_one)||void 0===t?void 0:t.checked_in_at,e.checkedInDateTime=new Date(null===(n=null==o?void 0:o.insert_visit_one)||void 0===n?void 0:n.checked_in_at),console.log("clickCheckIn -> this.checkedInTimestampStringIdentifier",e.checkedInTimestampStringIdentifier,e.checkedInDateTime),i})));this.checkedInObs=t}}},{key:"clickCheckOut",value:function(i){var e=this;if(console.log("clickCheckOut -> event",i),console.log("placeUUID, visitorUUID, checkInTimestampString",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier),void 0!==this.placeUUID&&void 0!==this.visitorUUIDForCheckin&&void 0!==this.checkedInTimestampStringIdentifier){var t=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier).pipe(Object(d.a)((function(i){var t,n;return console.log("clickCheckOut -> interceptResult",i),e.checkedOutDateTime=new Date(null===(n=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.update_visit_by_pk)||void 0===n?void 0:n.checked_out_at),i})));this.checkedOutObs=t,this.checkedOutObs.subscribe((function(i){console.log("clickCheckOut -> a",i)}))}else console.log("Invalid details for checkout not stored.",this.placeUUID,this.visitorUUIDForCheckin,this.checkedInTimestampStringIdentifier)}}]),i}(),V.\u0275fac=function(i){return new(i||V)(h.Ib(b.a),h.Ib(p.a),h.Ib(l.a),h.Ib(f.a),h.Ib(C),h.Ib(U))},V.\u0275cmp=h.Cb({type:V,selectors:[["app-visitor"]],decls:56,vars:22,consts:[["horizontal","start","vertical","bottom","slot","fixed","size","large"],["color","primary",3,"click"],["name","arrow-redo-circle-outline","size","large"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/les-logo-1-min-4kB.png","alt","Placeholder-image"],[2,"padding-left","0.5em","max-width","fit-content"],[2,"padding-left","0.55em"],["name","people"],["name","timer-outline"],["position","floating"],["formControlName","visitor_first_name","type","text","required","",3,"ngClass"],["formControlName","visitor_last_name","type","text","required","",3,"ngClass"],["formControlName","visitor_phone","type","tel","size","12","required","",3,"ngClass"],["formControlName","visitor_email","type","text","required","",3,"ngClass"],["icon-only","","size","block",1,"disable-button-greyed",3,"disabled","click"],["name","person-add-outline","slot","icon-only"],["type","submit"],[4,"ngIf","ngIfElse"],["pendingCheckIn",""],["pendingCheckOut",""],["color","light"],[3,"disabled","click"],["name","log-in-outline"],[3,"disabled","color","click"],["name","log-out-outline"]],template:function(i,e){if(1&i&&(h.Nb(0,"ion-header"),h.Nb(1,"ion-toolbar"),h.Nb(2,"ion-title"),h.nc(3,"Checki\u2705"),h.Mb(),h.Mb(),h.Mb(),h.Nb(4,"ion-fab",0),h.Nb(5,"ion-fab-button",1),h.Vb("click",(function(){return e.clickAutofill()})),h.Jb(6,"ion-icon",2),h.Mb(),h.Mb(),h.Nb(7,"ion-content"),h.Nb(8,"form",3,4),h.Vb("ngSubmit",(function(i){return e.submitForm(i)})),h.Nb(10,"ion-list"),h.Nb(11,"ion-list-header"),h.Nb(12,"ion-avatar"),h.Jb(13,"img",5),h.Mb(),h.Nb(14,"ion-label"),h.Nb(15,"h1",6),h.nc(16),h.Yb(17,"async"),h.Mb(),h.Nb(18,"h2",7),h.Jb(19,"ion-icon",8),h.nc(20),h.Yb(21,"async"),h.Jb(22,"ion-icon",9),h.nc(23),h.Yb(24,"async"),h.Mb(),h.Jb(25,"h3"),h.Mb(),h.Mb(),h.Nb(26,"ion-item"),h.Nb(27,"ion-label",10),h.nc(28," First name "),h.Mb(),h.Jb(29,"ion-input",11),h.Mb(),h.Nb(30,"ion-item"),h.Nb(31,"ion-label",10),h.nc(32," Last name "),h.Mb(),h.Jb(33,"ion-input",12),h.Mb(),h.Nb(34,"ion-item"),h.Nb(35,"ion-label",10),h.nc(36," Phone number "),h.Mb(),h.Jb(37,"ion-input",13),h.Mb(),h.Nb(38,"ion-item"),h.Nb(39,"ion-label",10),h.nc(40," Email address or residential address "),h.Mb(),h.Jb(41,"ion-input",14),h.Mb(),h.Mb(),h.Nb(42,"ion-button",15),h.Vb("click",(function(i){return e.submitForm(i)})),h.Jb(43,"ion-icon",16),h.Mb(),h.Jb(44,"button",17),h.Mb(),h.lc(45,F,4,7,"ng-container",18),h.lc(46,O,4,5,"ng-template",null,19,h.mc),h.Jb(48,"br"),h.lc(49,M,3,4,"ng-container",18),h.lc(50,N,4,6,"ng-template",null,20,h.mc),h.Jb(52,"br"),h.Nb(53,"ion-text",21),h.nc(54),h.Yb(55,"async"),h.Mb(),h.Mb()),2&i){var t,n,o,r=h.hc(47),c=h.hc(51);h.yb(8),h.dc("formGroup",e.visitorForm),h.yb(8),h.pc(" ",null==(t=h.Zb(17,14,e.placeDetails))?null:t.place_name," "),h.yb(4),h.pc(" ",null==(n=h.Zb(21,16,e.placeDetails))?null:n.place_capacity,"\xa0 "),h.yb(3),h.pc(" ",null==(o=h.Zb(24,18,e.placeDetails))?null:o.place_stay_estimate_minutes," "),h.yb(6),h.dc("ngClass",null!=e.visitorForm.controls.visitor_first_name&&e.visitorForm.controls.visitor_first_name.pristine?"":null!=e.visitorForm.controls.visitor_first_name&&e.visitorForm.controls.visitor_first_name.invalid?"error-background":"success-background"),h.yb(4),h.dc("ngClass",null!=e.visitorForm.controls.visitor_last_name&&e.visitorForm.controls.visitor_last_name.pristine?"":null!=e.visitorForm.controls.visitor_last_name&&e.visitorForm.controls.visitor_last_name.invalid?"error-background":"success-background"),h.yb(4),h.dc("ngClass",null!=e.visitorForm.controls.visitor_phone&&e.visitorForm.controls.visitor_phone.pristine?"":null!=e.visitorForm.controls.visitor_phone&&e.visitorForm.controls.visitor_phone.invalid?"error-background":"success-background"),h.yb(4),h.dc("ngClass",null!=e.visitorForm.controls.visitor_email&&e.visitorForm.controls.visitor_email.pristine?"":null!=e.visitorForm.controls.visitor_email&&e.visitorForm.controls.visitor_email.invalid?"error-background":"success-background"),h.yb(1),h.dc("disabled",e.visitorForm.invalid),h.yb(3),h.dc("ngIf",e.checkedInDateTime)("ngIfElse",r),h.yb(4),h.dc("ngIf",e.checkedOutDateTime)("ngIfElse",c),h.yb(5),h.pc(" | ",h.Zb(55,20,e.checkedInObs)?" Checked in ":""," | {{checkedOutObs | async} ? ' Checked out ' : ' '} ")}},directives:[u.j,u.x,u.w,u.h,u.i,u.k,u.g,l.n,l.j,l.e,u.r,u.s,u.b,u.q,u.m,u.l,u.C,l.i,l.c,l.l,s.k,u.e,s.m,u.v],pipes:[s.b,s.e],styles:['@charset "UTF-8";.submit-enter[_ngcontent-%COMP%]{position:absolute;visibility:hidden;left:-1000px}ion-icon[_ngcontent-%COMP%]{vertical-align:middle}ion-input[_ngcontent-%COMP%]   .error-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-danger-rgb),0.8)}.error-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-danger-rgb),0.6)}.success-background[_ngcontent-%COMP%]{--background:rgba(var(--ion-color-success-rgb),0.6)}.success-background[_ngcontent-%COMP%]:after{content:"\u2705"}.disable-button-greyed[_ngcontent-%COMP%]:disabled, disable-button-greyed[disabled][_ngcontent-%COMP%]{color:#fff!important;opacity:.8!important;background:#b3b3b3!important}']}),V)}],q=((T=function i(){c(this,i)}).\u0275mod=h.Gb({type:T}),T.\u0275inj=h.Fb({factory:function(i){return new(i||T)},imports:[[b.i.forChild(S)],b.i]}),T),E=((w=function i(){c(this,i)}).\u0275mod=h.Gb({type:w}),w.\u0275inj=h.Fb({factory:function(i){return new(i||w)},imports:[[s.c,l.f,l.k,u.y,q]]}),w)}}])}();